# Detecting unknown malicious code by applying classification techniques on OpCode patterns【2012】
#【通过应用基于opcode模式的分类技术检测未知恶意代码】
## 方法过程总结：
（1）用了文献12的数据集（恶意代码，正常代码文件），有个网址不能上了。

（2）先unpacked，用了文献36/37/38的unpacked方法（主要解决代码混淆问题：压缩、加壳等，恶意软件和正常软件都会用代码混淆，正常软件是为了防抄袭。文献证明先unpacked再分类可以提高准确率。）

（3）然后用IDA-pro工具做分解，得到可执行文件的汇编代码。

（4）然后提取Opcode n-gram，1-6都提取，结果最多的5千万+，不能直接用特征选择工具，算不完。

（5）然后计算OP-Code的DF TF值，DF小说明这个term对分类结果影响小，这样特征向量这个位置的值可能很小或者为0，为了避免特征向量0太多，取DF前1000大。

（6）然后再用3中特征选择方法（DF，Gain Ratio，Fisher Score）取前50/100/200/300的特征。

（7）然后用7种分类器做实验。

##评估：
根据6个问题设置3组实验。第一组决定最好设置：
（1）term的表示用TF还是TFDF。结果是一样，应为先取了DF前1000的term。因为加入新文件就需要重新算TFIDF，所以用TF就行。

（2）n-gram的n取多少（1-6）。取较小，2合适，或3/4，不同分类器的最优n不同。

（3）特征选择取top多少，用哪种特征选择算法。结论是top越多越好。（300），算法用DF或FS。

（4）用哪种分类器。结论是随机森林和集成决策树最好，朴素贝叶斯和集成贝叶斯最差。

（5）是否需要用不同的n-gram的n值。结论是不用，用了准确率会下降。
第二组决定训练集中恶意代码比例。训练集和测试集各5种比例测试25次。结论是对两个set的MFP不敏感，尤其对测试集的MFP不敏感。认为是opcode n-gram这种特征表示方法的优越性。
第三组决定是否根据年份更新训练集。训练2000-200k，测试200k+1-2007。测试作图。
评价指标用TPR FPR Accuracy（分对的文件数除以总文件数），Gmeans。
